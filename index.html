import json
import os
from datetime import datetime

def main():
    print("\n=== Updating HTML ===\n")
    
    # Load news
    if not os.path.exists('news_data.json'):
        print("‚ùå No news_data.json found!")
        return
    
    with open('news_data.json', 'r', encoding='utf-8') as f:
        news = json.load(f)
    
    # Check audio files
    audio_files = []
    for i in range(50):
        if os.path.exists(f'audio/news_{i}.mp3'):
            audio_files.append(i)
    
    print(f"üì∞ News items: {len(news)}")
    print(f"üéôÔ∏è Audio files: {len(audio_files)}")
    
    # Read HTML
    with open('index.html', 'r', encoding='utf-8') as f:
        html = f.read()
    
    # Find and replace news data
    news_json = json.dumps(news[:50], ensure_ascii=False)
    audio_json = json.dumps(audio_files)
    
    # Find the start and end of news array
    news_start = html.find('const news=[')
    if news_start == -1:
        print("‚ùå Could not find 'const news=[' in HTML")
        return
    
    # Find the end of the news array (];)
    news_end = html.find('];', news_start)
    if news_end == -1:
        print("‚ùå Could not find end of news array")
        return
    
    # Replace news data
    new_html = html[:news_start] + f'const news={news_json}' + html[news_end+1:]
    
    # Find and replace audioFiles
    audio_start = new_html.find('const audioFiles=[')
    if audio_start != -1:
        audio_end = new_html.find('];', audio_start)
        if audio_end != -1:
            new_html = new_html[:audio_start] + f'const audioFiles={audio_json}' + new_html[audio_end+1:]
    
    # Update timestamp
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M UTC")
    new_html = new_html.replace('Last updated: Loading...', f'Last updated: {timestamp}')
    
    # Also try to update existing timestamp
    import re
    new_html = re.sub(r'Last updated: \d{4}-\d{2}-\d{2} \d{2}:\d{2} UTC', f'Last updated: {timestamp}', new_html)
    
    # Write HTML
    with open('index.html', 'w', encoding='utf-8') as f:
        f.write(new_html)
    
    print(f"‚úÖ HTML updated!")
    print(f"‚úÖ News: {len(news[:50])} items")
    print(f"‚úÖ Audio: {len(audio_files)} files")
    print(f"‚è∞ Timestamp: {timestamp}\n")

if __name__ == "__main__":
    main()
